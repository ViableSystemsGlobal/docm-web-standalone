(()=>{var e={};e.id=374,e.ids=[374],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34068:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>u,serverHooks:()=>m,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>d});var o={};r.r(o),r.d(o,{GET:()=>l});var s=r(96559),a=r(48088),i=r(37719),n=r(32190),c=r(56621);async function l(e){try{let{searchParams:t}=new URL(e.url),r=t.get("type"),o=parseInt(t.get("limit")||"20"),s=(0,c.z)().from("media_library").select(`
        collection_name,
        collection_category,
        collection_date,
        description,
        type,
        url,
        uploaded_at
      `).filter("collection_name","not.is",null);r&&"mixed"!==r&&(s=s.eq("type",r));let{data:a,error:i}=await s;if(i)return console.error("Error fetching media collections:",i),n.NextResponse.json({collections:[],total:0,source:"error",message:"Failed to fetch collections from database"});if(!a||0===a.length)return n.NextResponse.json({collections:[],total:0,source:"database",message:"No collections found in database"});let l=new Map;a.forEach(e=>{let t=e.collection_name;l.has(t)||l.set(t,{id:t.toLowerCase().replace(/\s+/g,"-"),title:t,category:e.collection_category,date:e.collection_date,description:e.description,photoCount:0,videoCount:0,totalCount:0,coverImage:null,mediaUrls:[],createdAt:e.uploaded_at,gradient:function(){let e=["from-blue-600 to-purple-700","from-green-600 to-teal-700","from-orange-600 to-red-700","from-purple-600 to-pink-700","from-cyan-600 to-blue-700","from-indigo-600 to-purple-700","from-pink-600 to-purple-700","from-yellow-600 to-orange-700"];return e[Math.floor(Math.random()*e.length)]}()});let r=l.get(t);"image"===e.type?(r.photoCount++,r.coverImage||(r.coverImage=e.url)):"video"===e.type&&(r.videoCount++,r.coverImage||0!==r.photoCount||(r.coverImage=e.url)),r.totalCount=r.photoCount+r.videoCount,r.mediaUrls.push(e.url),new Date(e.uploaded_at)>new Date(r.createdAt)&&(r.createdAt=e.uploaded_at)});let u=Array.from(l.values());return u.sort((e,t)=>new Date(t.date||t.createdAt).getTime()-new Date(e.date||e.createdAt).getTime()),u=u.slice(0,o),n.NextResponse.json({collections:u,total:u.length,source:"database",message:`Found ${u.length} collections from database`})}catch(e){return console.error("Unhandled error in media collections API:",e),n.NextResponse.json({collections:[],total:0,source:"error",message:"Server error fetching collections"},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/media-collections/route",pathname:"/api/media-collections",filename:"route",bundlePath:"app/api/media-collections/route"},resolvedPagePath:"/Users/nanasasu/docm-web-standalone/src/app/api/media-collections/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:p,workUnitAsyncStorage:d,serverHooks:m}=u;function g(){return(0,i.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:d})}},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},51906:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=51906,e.exports=t},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56621:(e,t,r)=>{"use strict";r.d(t,{z:()=>s});var o=r(34386);let s=()=>{let e="https://ufjfafcfkalaasdhgcbi.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVmamZhZmNma2FsYWFzZGhnY2JpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3MTQ3MTMsImV4cCI6MjA2MzI5MDcxM30.PzwQAeRUJDK8llZf0awLwgW6j-pAmZPOgz55USsOnyo";if(!e||!t)throw Error("Supabase environment variables not configured");return(0,o.createServerClient)(e,t,{cookies:{get:()=>null,set(){},remove(){}}})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[4447,9398,4386,580],()=>r(34068));module.exports=o})();